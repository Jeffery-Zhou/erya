{% extends "base.html" %}
{% load string_filter users_tags %}
{% block title %}{{post.title}}{% endblock %}

{% block content %}
<div class="container">
  <div class="ui huge breadcrumb">
    <a class="section" href="/">首页</a>
    <div class="divider"> / </div>
    <a class="section" href="{% url 'category' post.category.id %}">{{post.category.name}}</a>
    <div class="divider"> / </div>
    <div class="active section">{{post.title}}</div>
  </div>
  
  <div id="post-and-reply">
    <div class="ui segment" id="js-id-post-{{ post.id }}">
      <div class="ui grid stackable">
        <div class="eight wide column">
          <div class="card">
            <div class="content">
              <img class="floated mini ui image" src="{{ post.author.email|gravatar }}">
              <div class="header"><a href="{% url 'profile' post.author.id %}">{{ post.author }}</a></div>
              <div class="meta">发表于 {{ post.created_at|timesince }} <a href="javascript:void(0)" onclick="showModal(event, this)" class="js-reply-post"><i class="icon circle"></i>回复</a>{% if request.user == post.author %}<a href="javascript:void(0)" class="delete"><i class="icon circle"></i>删除</a>{% endif %}</div>
            </div>
          </div>
        </div>
        <div class="eight wide column">
          <div class="ui tiny statistics">
            <div class="statistic">
              <div class="value">
                22
              </div>
              <div class="label">
                Replies
              </div>
            </div>
            <div class="statistic">
              <div class="value">
                31,200
              </div>
              <div class="label">
                Views
              </div>
            </div>
            <div class="statistic">
              <div class="value">
                0
              </div>
              <div class="label">
                Like
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="ui horizontal divider">Text</div>
      <div class="content">
        {{ post.content|removetags:"script"|safe }}
      </div>
    </div>

    <div class="ui segment">
      {% for reply in post_replies %}
      <div class="ui comments">
        <div class="comment" id="js-id-reply-{{ reply.id }}">
          <a href="{% url 'profile' post.author.id %}" class="avatar"><img class="ui image avatar" src="{{ reply.author.email|gravatar }}" ></a>
          <div class="content">
            <a class="author">{{ reply.author }}</a>
            <div class="metadata"><div class="date">{{ reply.created_at|timesince }}</div></div>
            <div class="text">{{ reply.content|removetags:"script"|safe }}</div>
            <div class="actions">
              <a href="javascript:void(0)" onclick="showModal(event, this)" data-username="{{ reply.author.username }}" class="js-reply-post" class="reply js-reply-post">回复</a>
              <!-- <a class="edit">编辑</a> -->
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<div class="ui modal" id="js-id-modal">
<!--   <i class="close icon"></i> -->
  <div class="content">
    <form id="js-id-form">{% csrf_token %}
    <div class="ui form">
      <div class="field">
        <div class="input"><input type="text" name="title" value="{{ post.title }}" /></div>
      </div>
      <div class="field">
        <div id="js-id-modal-editor" style="border: 1px solid #eee; border-radius: 5px;"></div>
        <textarea name="content" style="display: none;"></textarea>
      </div>
    </div>
    </form>
  </div>
  <div class="actions">
    <a href="javascript:void(0)" class="ui button green" id="js-id-btn-save">提交</a>
    <div class="ui button" onclick="$('#js-id-modal').modal('hide');">取消</div>
  </div>
</div>
{% endblock %}

{% block script %}


<script>
if (location.hash == '#latest') window.scrollTo(0, document.body.scrollHeight);

</script>
{% endblock %}
